<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page Title</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""></script>
  <!-- no UI slider -->
  <link href="https://cdn.jsdelivr.net/npm/nouislider@14.6.4/distribute/nouislider.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.4/distribute/nouislider.min.js"></script>
  <!-- wNumb -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"></script>

</head>
<body>
  <!-- link that loads the ski resort data from an external file -->
  <script type="text/javascript" src="data/ski_stats.js"></script>
  
  <!-- Navigation bar to access other maps -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">My Ski Resort</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page1.html">Page 1</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page2.html">Page 2</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page3.html">Page 3</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page4.html">Page 4</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page5.html">Page 5</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page6.html">Page 6</a>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  <div id="skiAcres-slider" class="slider"></div>
  <div id="skiSummit-slider" class="slider"></div>
  <div id="skiBase-slider" class="slider"></div>
  <div id="skiVertical-slider" class="slider"></div>
  <div id="map"></div>
  

  <script>
    // Add basemap
    // Stamen_TonerLite
    var Stamen_TonerLite = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        subdomains: 'abcd',
        minZoom: 0,
        maxZoom: 20,
        ext: 'png'
    });
    // OSM HOT
    var OpenStreetMap_HOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr/" target="_blank">OpenStreetMap France</a>'
    });
    // OpenStreetMap layer
    var OSM = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      });
    // OpenTopoMap layer
    var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    });
    // Esri Satellite
    var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });

    // Initialize map
    var map = L.map('map', {
      center: [37.0902, -95.7129],
      zoom: 5
    });

      // Initialize noUiSliders
      const sliders = {
        skiAcres: document.getElementById('skiAcres-slider'),
        skiSummit: document.getElementById('skiSummit-slider'),
        skiBase: document.getElementById('skiBase-slider'),
        skiVertical: document.getElementById('skiVertical-slider')
      };
      
      var format = wNumb({ decimals: 0 });


      function initializeSlider(sliderElement, min, max, startValues, step = 1) {
          noUiSlider.create(sliderElement, {
              start: startValues,
              orientation: 'vertical',
              // A linear range
              range: { min, max },
              // steps of 1
              step,
              tooltips: true,
              format: format,
              pips: { mode: 'steps', format: format },        
          });

          sliderElement.noUiSlider.set(startValues);
      }

      // Initialize the sliders
      initializeSlider(sliders.skiAcres, 0, 7500, [0, 7500]);
      initializeSlider(sliders.skiSummit, 0, 10000, [0, 10000]);
      initializeSlider(sliders.skiBase, 0, 10000, [0, 10000]);
      initializeSlider(sliders.skiVertical, 0, 4000, [0, 4000]);

      map.on('overlayadd', function(eventLayer){
          switch (eventLayer.name) {
              case "skiAcres":
                  initializeSlider(sliders.skiAcres, 0, 7500, [0, 7500]);
                  break;
              case "skiSummit":
                  initializeSlider(sliders.skiSummit, 0, 10000, [0, 10000]);
                  break;
              case "skiBase":
                  initializeSlider(sliders.skiBase, 0, 10000, [0, 10000]);
                  break;
              case "skiVertical":
                  initializeSlider(sliders.skiVertical, 0, 4000, [0, 4000]);
                  break;
          }
      });

      map.on('overlayremove', function(eventLayer){
      switch (eventLayer.name) {
          case "skiAcres":
              sliders.skiAcres.noUiSlider.destroy();
              break;
          case "skiSummit":
              sliders.skiSummit.noUiSlider.destroy();
              break;
          case "skiBase":
              sliders.skiBase.noUiSlider.destroy();
              break;
          case "skiVertical":
              sliders.skiVertical.noUiSlider.destroy();
              break;
      }
  });



    //Ski Area
  var skiAcres =  L.geoJSON(ski_stats, {
      pointToLayer: function (feature, latlng) {
          // Your pointToLayer code
          var circleSize;      
          if (feature.properties.acres <= 100) circleSize = 4;
          else if (feature.properties.acres <= 300) circleSize = 6;
          else if (feature.properties.acres <= 800) circleSize = 8;
          else if (feature.properties.acres <= 2000) circleSize = 10;
          else if (feature.properties.acres <= 3000) circleSize = 14;
          else if (feature.properties.acres >3000) circleSize = 18;
          else circleSize = 0;

          var circleColor;      
          if (feature.properties.acres <= 100) circleColor = '#3288bd';
          else if (feature.properties.acres <= 300) circleColor = '#99d594';
          else if (feature.properties.acres <= 800) circleColor = '#e6f598';
          else if (feature.properties.acres <= 2000) circleColor = '#fee08b';
          else if (feature.properties.acres <= 3000) circleColor = '#fc8d59';
          else if (feature.properties.acres > 3000) circleColor = '#d53e4f';
          else circleColor = '#737373';

          var marker = L.circleMarker(latlng, {radius: circleSize, color: circleColor, weight: 1, opacity: 4, fillOpacity: 0.7});
          marker.bindPopup("<b> Resort Name: </b>" + feature.properties.resort_name + "<br><b> Acres: </b>" + feature.properties.acres + "</p>");
          return marker;
      }
    });

    
    // Add features.properties.summit from ski_stats to show in overlays
    // Summit elevation
    var skiSummit = L.geoJSON(ski_stats, {
    pointToLayer: function (feature, latlng) {
        // Your pointToLayer code
        var circleSize;      
        if (feature.properties.summit <= 1000) circleSize = 4;
        else if (feature.properties.summit <= 2000) circleSize = 6;
        else if (feature.properties.summit <= 5000) circleSize = 8;
        else if (feature.properties.summit <= 8000) circleSize = 10;
        else if (feature.properties.summit <= 10000) circleSize = 14;
        else if (feature.properties.summit > 10000) circleSize = 18;
        else circleSize = 0;

        var circleColor;      
        if (feature.properties.summit <= 1000) circleColor = '#3288bd';
        else if (feature.properties.summit <= 2000) circleColor = '#99d594';
        else if (feature.properties.summit <= 5000) circleColor = '#e6f598';
        else if (feature.properties.summit <= 8000) circleColor = '#fee08b';
        else if (feature.properties.summit <= 10000) circleColor = '#fc8d59';
        else if (feature.properties.summit > 10000) circleColor = '#d53e4f';
        else circleColor = '#737373';

        var marker = L.circleMarker(latlng, {radius: circleSize, color: circleColor, weight: 1, opacity: 4, fillOpacity: 0.7});
        marker.bindPopup("<b> Resort Name: </b>" + feature.properties.resort_name + "<br><b> Summit Elevation: </b>" + feature.properties.summit + "</p>");
        return marker;
      }
    });

    // Base Elevation from ski_stats geoJSON file
    var skiBase = L.geoJSON(ski_stats, {
    pointToLayer: function (feature, latlng) {
        // Your pointToLayer code
        var circleSize;      
        if (feature.properties.base <= 1000) circleSize = 4;
        else if (feature.properties.base <= 2000) circleSize = 6;
        else if (feature.properties.base <= 5000) circleSize = 8;
        else if (feature.properties.base <= 8000) circleSize = 10;
        else if (feature.properties.base <= 10000) circleSize = 14;
        else if (feature.properties.base > 10000) circleSize = 18;
        else circleSize = 0;

        var circleColor;      
        if (feature.properties.base <= 1000) circleColor = '#3288bd';
        else if (feature.properties.base <= 2000) circleColor = '#99d594';
        else if (feature.properties.base <= 5000) circleColor = '#e6f598';
        else if (feature.properties.base <= 8000) circleColor = '#fee08b';
        else if (feature.properties.base <= 10000) circleColor = '#fc8d59';
        else if (feature.properties.base > 10000) circleColor = '#d53e4f';
        else circleColor = '#737373';

        var marker = L.circleMarker(latlng, {radius: circleSize, color: circleColor, weight: 1, opacity: 4, fillOpacity: 0.7});
        marker.bindPopup("<b> Resort Name: </b>" + feature.properties.resort_name + "<br><b> Base Elevation: </b>" + feature.properties.base + "</p>");
        return marker;
      }
    });

    // Vertical Drop from ski_stats geoJSON file
    var skiVertical = L.geoJSON(ski_stats, {
    pointToLayer: function (feature, latlng) {
        // Your pointToLayer code
        var circleSize;      
        if (feature.properties.vertical <= 500) circleSize = 4;
        else if (feature.properties.vertical <= 1000) circleSize = 6;
        else if (feature.properties.vertical <= 2000) circleSize = 8;
        else if (feature.properties.vertical <= 3000) circleSize = 10;
        else if (feature.properties.vertical <= 4000) circleSize = 14;
        else if (feature.properties.vertical > 4000) circleSize = 18;
        else circleSize = 0;

        var circleColor;      
        if (feature.properties.vertical <= 500) circleColor = '#3288bd';
        else if (feature.properties.vertical <= 1000) circleColor = '#99d594';
        else if (feature.properties.vertical <= 2000) circleColor = '#e6f598';
        else if (feature.properties.vertical <= 3000) circleColor = '#fee08b';
        else if (feature.properties.vertical <= 4000) circleColor = '#fc8d59';
        else if (feature.properties.vertical > 4000) circleColor = '#d53e4f';
        else circleColor = '#737373';

        var marker = L.circleMarker(latlng, {radius: circleSize, color: circleColor, weight: 1, opacity: 4, fillOpacity: 0.7});
        marker.bindPopup("<b> Resort Name: </b>" + feature.properties.resort_name + "<br><b> Vertical Drop: </b>" + feature.properties.vertical + "</p>");
        return marker;
      }
    });

    // Base maps
    var baseMaps = {
      "Stamen Toner Lite": Stamen_TonerLite,
      "OpenStreetMap HOT": OpenStreetMap_HOT,
      "OpenStreetMap": OSM,
      "OSM Topo": OpenTopoMap,
      "Esri World Imagery": Esri_WorldImagery
    };

    // Overlays
    var overlayMaps = {
      "Size": skiAcres,
      "Summit Elevation": skiSummit,
      "Base Elevation": skiBase,
      "Vertical Drop": skiVertical
    };

    // Layer control
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Add base layer & overlay to the map
    baseMaps["Stamen Toner Lite"].addTo(map);
    overlayMaps["Size"].addTo(map);
    
    // add scale bar
    L.control.scale().addTo(map);

    // Define a new control for the title
    var title = L.control({position: 'topleft'});

    // When the control is added to the map, insert a div with your title
    title.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info map-title');
        div.innerHTML = '<h4>Size, Elevation, and Vertical Drop</h4><p>Click on a resort to see name and details.</p>';
        return div;
    };

    // Add the title to the map
    title.addTo(map);

    // Error checking
    if(typeof L === "undefined"){
    console.error('Leaflet library is not loaded');
    }
    else {
      console.log('Map is ready');

    }

    if(sliders.skiAcres !== undefined){
  initializeSlider(sliders.skiAcres, 0, 7500, [0, 7500]);
}else{
  console.error('skiAcres-slider is not defined');
}
if(sliders.skiVertical !== undefined){
  initializeSlider(sliders.skiVertical, 0, 5000, [0, 5000]);
}else{
  console.error('skiVertical-slider is not defined');
}
if(sliders.skiSummit !== undefined){
  initializeSlider(sliders.skiSummit, 0, 15000, [0, 15000]);
}else{
  console.error('skiSummit-slider is not defined');
}
if(sliders.skiBase !== undefined){
  initializeSlider(sliders.skiBase, 0, 10000, [0, 10000]);
}else{
  console.error('skiBase-slider is not defined');
}

try{
  initializeSlider(sliders.skiAcres, 0, 7500, [0, 7500]);
}catch(e){
  console.error('Error initializing skiAcres-slider: ', e);
}


  </script>